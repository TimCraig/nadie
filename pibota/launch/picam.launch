<launch>
	<arg name="doDebug" default="false" />
	<arg if="$(arg doDebug)" name="launchPrefix" value="xterm -e gdb --args" />
	<arg unless="$(arg doDebug)" name="launchPrefix" value="" />
	<arg name="camera_frame_id" default="raspicam"/>
	<arg name="camera_id" default="0"/>
	<arg name="camera_name" default="camerav2_1280x720"/>
	<arg name="enable_imv" default="false"/>
	<arg name="enable_raw" default="false"/>

	<!-- top - 00:09:01 up  4:12,  3 users,  load average: 4.76, 1.94, 0.97 w 90fps -->
	
	<node 
		type="raspicam_node" 
		pkg="raspicam_node" 
		name="raspicam_node" 
		output="screen"
		launch-prefix="$(arg launchPrefix)" >
		<param name="camera_frame_id" value="$(arg camera_frame_id)"/>  
		<param name="camera_id" value="$(arg camera_id)"/> 
		<param name="camera_info_url" value="file:///home/wimble/.ros/camera_info/camerav2_1280x720.yaml" />
		<!--param name="camera_info_url" value="package://pibota/camera_info/camerav2_1280x720.miranda.yaml"/-->
		<param name="camera_name" value="$(arg camera_name)"/>
	    <param name="enable_imv" value="$(arg enable_imv)"/>
		<param name="enable_raw" value="$(arg enable_raw)"/>
		<!-- We are running at 90fps to reduce motion blur -->
		<param name="framerate" value="25"/>
		<param name="height" value="720"/>
		<param name="hFlip" value="true" />
		<param name="vFlip" value="true" />
		<param name="width" value="1280"/>
	</node>

	<node 
		type="republish" 
		pkg="image_transport" 
		name="compressed_to_raw_video" 
		output="screen"
		args="compressed in:=/raspicam_node/image out:=/raspicam_node/raw_image" >
	</node>

	<include file="$(find aruco_detect)/launch/aruco_detect.launch" >
	  <arg name="camera" value="/raspicam_node" />
	  <arg name="image" value="raw_image" />
	</include>

	<include file="$(find fiducial_slam)/launch/fiducial_slam.launch" >
		<arg name="odom_frame" value="fiducial_odom" />
		<arg name="publish_6dof_pose" value="false" />
	</include>

	<node
		name="raspicam_tf"
		pkg="tf"
		type="static_transform_publisher"
		args="0.0 0.0 0.0 0 0 0 base_link raspicam 100"
	/>

	<!--node
		type="image_rotate"
		pkg="image_rotate"
		name="image_rotate"
		output="screen" >
		<remap from="image" to="/raspicam_node/raw_image" />
		<param name="source_frame_id" value="" />
		<param name="source_x" value="0" />
		<param name="source_y" value="1" />
		<param name="source_z" value="0" />
		<param name="target_frame_id" value="" />
		<param name="target_x" value="1" />
		<param name="target_y" value="0" />
		<param name="target_z" value="0" />
		<param name="output_frame_id" value="" />
		<param name="output_image_size" value="3" />
	</node-->
</launch>
